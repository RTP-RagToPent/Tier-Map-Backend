# Tier-Map-Backend

ãƒ†ã‚£ã‚¢ãƒãƒƒãƒ—ã¯ã€è¿‘å ´Ã—ã‚¸ãƒ£ãƒ³ãƒ«ã®"ãƒŸãƒ‹æ—…"ã‚’ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼å½¢å¼ã§ä½“é¨“ã—ã€è©•ä¾¡ã‹ã‚‰ãƒ†ã‚£ã‚¢è¡¨ã®è‡ªå‹•ç”Ÿæˆã€SNSå…±æœ‰ã¾ã§ä¸€æ°—é€šè²«ã§æä¾›ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã§ã™ã€‚

## ğŸ¯ ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ç›®çš„

### è§£æ±ºã™ã‚‹èª²é¡Œ

- åœ°åŸŸæƒ…å ±ãŒæ•£åœ¨ã—ã€ã‚¹ãƒãƒƒãƒˆé¸ã³ã€œè¨˜éŒ²ã€œå…±æœ‰ã®ãƒ•ãƒ­ãƒ¼ãŒåˆ†æ–­ã—ã¦ã„ã‚‹
- è¡Œå‹•ãŒä¸€éæ€§ã§ç¶™ç¶šã—ãªã„

### æä¾›ã™ã‚‹ä¾¡å€¤

3ã€œ7ã‚¹ãƒãƒƒãƒˆã®**å°ã•ãªé”æˆ**Ã—**ãƒ©ãƒ³ã‚­ãƒ³ã‚°åŒ–(ãƒ†ã‚£ã‚¢è¡¨)**Ã—**å³å…±æœ‰**ã«ã‚ˆã‚Šã€é€±æœ«ã®å°ãƒã‚¿æ¢ç´¢ã‚’ç¿’æ…£åŒ–ã•ã›ã‚‹ä½“é¨“ã‚’æä¾›ã—ã¾ã™ã€‚

## ğŸ‘¥ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼

- **ä¸€æ¬¡**ï¼š20â€“40ä»£ / éƒ½å¸‚åœåœ¨ä½ / é€±æœ«ã«ã€Œè¿‘æ‰€ã®æ–°è¦é–‹æ‹“ã€ã‚’ã—ãŸã„ãƒ©ã‚¤ãƒˆå±¤
- **äºŒæ¬¡**ï¼šè·å ´ãƒ»ã‚µãƒ¼ã‚¯ãƒ«ãƒ»ã‚«ãƒƒãƒ—ãƒ«ã§**ã‚†ã‚‹ã„ç«¶äº‰**ã‚„å…±æœ‰ã‚’æ¥½ã—ã‚€äºº

### ãƒšãƒ«ã‚½ãƒŠä¾‹

- **A.** 28æ­³ ä¼šç¤¾å“¡ / åœŸæ›œã«å‹äººã¨**ãƒ©ãƒ¼ãƒ¡ãƒ³**é£Ÿã¹æ­©ã / LINEã§å…±æœ‰ãŒä¸­å¿ƒ
- **B.** 33æ­³ ã‚«ãƒƒãƒ—ãƒ« / **ã‚«ãƒ•ã‚§**å·¡ã‚Šï¼‹å†™çœŸæ˜ ãˆ / SNSã¯InstagramãŒå¤šã„

## ğŸš€ ä¸»è¦æ©Ÿèƒ½(PoCç‰ˆ)

1. **åœ°åŸŸÃ—ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸ã¶** â†’
   å€™è£œã‚¹ãƒãƒƒãƒˆãŒ3ã€œ5ä»¶ãƒªã‚¹ãƒˆï¼‹åœ°å›³è¡¨ç¤ºï¼ˆå¾’æ­©15åˆ†åœå†…ï¼‰
2. **ãƒ©ãƒªãƒ¼é–‹å§‹** â†’ å„ã‚¹ãƒãƒƒãƒˆã§**GPSãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³**ï¼‹â˜…è©•ä¾¡ï¼‹ã²ã¨è¨€ãƒ¡ãƒ¢
3. **å®Œèµ°** â†’ **ãƒ†ã‚£ã‚¢è¡¨ï¼ˆS/A/Bï¼‰**ã‚’è‡ªå‹•ç”Ÿæˆ â†’ å…±æœ‰ç”¨ç”»åƒã‚«ãƒ¼ãƒ‰ã‚’**LINEã§é€ä¿¡**

## ğŸ›  æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **Runtime**: Deno
- **Language**: TypeScript
- **Backend**: Supabase Edge Functions
- **Database**: Supabase (PostgreSQL)
- **Architecture**: Clean Architecture
- **Code Quality**: husky (Git hooks)

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```text
Tier-Map-Backend/
â”œâ”€â”€ api-test/                    # API ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ profile-api.sh
â”‚   â”œâ”€â”€ rallies-api.sh
â”‚   â”œâ”€â”€ rally-spots-api.sh
â”‚   â””â”€â”€ ratings-api.sh
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ controller/              # ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å±¤
â”‚   â”‚   â”œâ”€â”€ ProfilesController.ts
â”‚   â”‚   â”œâ”€â”€ RalliesController.ts
â”‚   â”‚   â”œâ”€â”€ RallySpotsController.ts
â”‚   â”‚   â””â”€â”€ RatingsController.ts
â”‚   â”œâ”€â”€ domain/                  # ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â””â”€â”€ repository.ts
â”‚   â”‚   â”œâ”€â”€ rally/
â”‚   â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â””â”€â”€ repository.ts
â”‚   â”‚   â”œâ”€â”€ rallySpot/
â”‚   â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â””â”€â”€ repository.ts
â”‚   â”‚   â”œâ”€â”€ rating/
â”‚   â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â””â”€â”€ repository.ts
â”‚   â”‚   â””â”€â”€ spot/
â”‚   â”‚       â”œâ”€â”€ models/
â”‚   â”‚       â””â”€â”€ repository.ts
â”‚   â”œâ”€â”€ functions/               # Edge Functions ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ profiles/
â”‚   â”‚   â”‚   â”œâ”€â”€ deno.json
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â””â”€â”€ router/
â”‚   â”‚   â””â”€â”€ rallies/
â”‚   â”‚       â”œâ”€â”€ deno.json
â”‚   â”‚       â”œâ”€â”€ index.ts
â”‚   â”‚       â””â”€â”€ router/
â”‚   â”œâ”€â”€ infrastructure/          # ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤
â”‚   â”‚   â””â”€â”€ supabase/
â”‚   â”‚       â”œâ”€â”€ auth.ts
â”‚   â”‚       â”œâ”€â”€ client.ts
â”‚   â”‚       â””â”€â”€ repository/
â”‚   â”œâ”€â”€ lib/                     # å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ httpResponse.ts
â”‚   â”‚   â”œâ”€â”€ log.ts
â”‚   â”‚   â””â”€â”€ parse.ts
â”‚   â””â”€â”€ usecase/                 # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤
â”‚       â”œâ”€â”€ profile/
â”‚       â”œâ”€â”€ rally/
â”‚       â”œâ”€â”€ rallySpot/
â”‚       â”œâ”€â”€ rating/
â”‚       â””â”€â”€ spot/
â”œâ”€â”€ commitlint.config.js
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§

#### users

èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±(Supabase Authç®¡ç†)

| Column | Type   | Key |
| ------ | ------ | --- |
| id     | uuid   | PK  |
| mail   | email  |     |
| pass   | string |     |

#### Profiles

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«

| Column     | Type               | Key |
| ---------- | ------------------ | --- |
| id         | INT auto increment | PK  |
| user_id    | uuid unique        | FK  |
| name       | string             |     |
| created_at | timestamp          |     |
| updated_at | timestamp          |     |

#### Rallies

ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼

| Column     | Type               | Key |
| ---------- | ------------------ | --- |
| id         | INT auto increment | PK  |
| profile_id | INT                | FK  |
| name       | string             |     |
| genre      | string             |     |
| created_at | timestamp          |     |
| updated_at | timestamp          |     |

#### Spots

è¨ªå•ã‚¹ãƒãƒƒãƒˆ

| Column     | Type      | Key |
| ---------- | --------- | --- |
| id         | string    | PK  |
| name       | string    |     |
| created_at | timestamp |     |
| updated_at | timestamp |     |

#### rallySpots

ãƒ©ãƒªãƒ¼ã¨ã‚¹ãƒãƒƒãƒˆã®ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«

| Column     | Type               | Key |
| ---------- | ------------------ | --- |
| id         | INT auto increment | PK  |
| rally_id   | INT                | FK  |
| spot_id    | string             | FK  |
| order_no   | INT                |     |
| created_at | timestamp          |     |
| updated_at | timestamp          |     |

#### Ratings

ã‚¹ãƒãƒƒãƒˆè©•ä¾¡

| Column        | Type               | Key |
| ------------- | ------------------ | --- |
| id            | INT auto increment | PK  |
| rally_spot_id | INT unique         | FK  |
| stars         | INT                |     |
| memo          | string             |     |
| created_at    | timestamp          |     |
| updated_at    | timestamp          |     |

## ğŸ“š API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

è©³ç´°ãªAPIä»•æ§˜ã«ã¤ã„ã¦ã¯ [API.md](./API.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹                                             | èª¬æ˜                   |
| -------- | ------------------------------------------------ | ---------------------- |
| GET      | /functions/v1/profiles/                          | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—       |
| PATCH    | /functions/v1/profiles/                          | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°       |
| GET      | /functions/v1/rallies/                           | ãƒ©ãƒªãƒ¼ä¸€è¦§å–å¾—         |
| POST     | /functions/v1/rallies/                           | ãƒ©ãƒªãƒ¼ä½œæˆ             |
| GET      | /functions/v1/rallies/:rally_id/                 | ãƒ©ãƒªãƒ¼è©³ç´°å–å¾—         |
| PATCH    | /functions/v1/rallies/:rally_id/                 | ãƒ©ãƒªãƒ¼æ›´æ–°             |
| GET      | /functions/v1/rallies/:rally_id/spots            | ãƒ©ãƒªãƒ¼ã‚¹ãƒãƒƒãƒˆä¸€è¦§å–å¾— |
| POST     | /functions/v1/rallies/:rally_id/spots            | ãƒ©ãƒªãƒ¼ã‚¹ãƒãƒƒãƒˆç™»éŒ²     |
| GET      | /functions/v1/rallies/:rally_id/spots/:spot_id   | ãƒ©ãƒªãƒ¼ã‚¹ãƒãƒƒãƒˆè©³ç´°å–å¾— |
| GET      | /functions/v1/rallies/:rally_id/ratings          | è©•ä¾¡ä¸€è¦§å–å¾—           |
| POST     | /functions/v1/rallies/:rally_id/ratings/         | è©•ä¾¡ä½œæˆ               |
| GET      | /functions/v1/rallies/:rally_id/ratings/:spot_id | è©•ä¾¡è©³ç´°å–å¾—           |

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

è©³ç´°ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã«ã¤ã„ã¦ã¯ [SETUP.md](./SETUP.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### å‰ææ¡ä»¶

- Deno 1.xä»¥ä¸Š
- Supabase CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

### ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

#### 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone https://github.com/RTP-RagToPent/Tier-Map-Backend.git
cd Tier-Map-Backend
```

#### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
cd supabase
cp .env.example .env.local
# .env.local ã‚’ç·¨é›†ã—ã¦å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
```

#### 3. Supabase ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã®èµ·å‹•

```bash
cd supabase
supabase functions serve --env-file .env.local
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

API ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ï¼š

```bash
# ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«APIã®ãƒ†ã‚¹ãƒˆ
./api-test/profile-api.sh

# ãƒ©ãƒªãƒ¼APIã®ãƒ†ã‚¹ãƒˆ
./api-test/rallies-api.sh

# ã‚¹ãƒãƒƒãƒˆAPIã®ãƒ†ã‚¹ãƒˆ
./api-test/rally-spots-api.sh

# è©•ä¾¡APIã®ãƒ†ã‚¹ãƒˆ
./api-test/ratings-api.sh
```

## ğŸ“ ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

- TypeScriptã®å³å¯†ãªå‹ãƒã‚§ãƒƒã‚¯ã‚’ä½¿ç”¨
- Clean Architectureã®åŸå‰‡ã«å¾“ã†
- ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯[Conventional Commits](https://www.conventionalcommits.org/)å½¢å¼ã‚’æ¨å¥¨
- huskyã«ã‚ˆã‚‹ã‚³ãƒŸãƒƒãƒˆå‰ã®ãƒªãƒ³ãƒˆãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ [LICENSE](./LICENSE)
ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¼‰ã•ã‚ŒãŸãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
